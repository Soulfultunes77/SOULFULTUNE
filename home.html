<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Your Profile - SoulfulTune</title>
    <style>
        /* Your existing CSS styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 400px;
            text-align: center;
        }

        h1 {
            color: #333;
        }

        label {
            font-size: 14px;
            margin-bottom: 6px;
            display: block;
            text-align: left;
        }

        input[type="text"], input[type="email"], input[type="password"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            width: 100%;
        }

        button:hover {
            background-color: #45a049;
        }

        .user-info {
            margin-bottom: 20px;
        }

        .user-info p {
            font-size: 14px;
            margin: 5px 0;
            color: #333;
        }

        .logout-btn {
            background-color: #f44336;
        }

        .logout-btn:hover {
            background-color: #e41e1e;
        }

        .logo-container {
            margin-bottom: 20px;
            cursor: pointer;
        }

        .logo-container img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid #ddd;
        }

        /* Separate the buttons with margin */
        .button-container {
            display: flex;
            flex-direction: column;
            gap: 10px; /* This will create space between the buttons */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Update Your Profile</h1>

        <!-- Profile Logo -->
        <div class="logo-container" id="logoContainer">
            <img src="default-logo.png" alt="Profile Logo" id="profileLogo">
        </div>

        <!-- Display Logged-In User Information -->
        <div class="user-info">
            <p id="userUIDDisplay">UID: Loading...</p>
            <p id="userEmail">Email: Loading...</p>
            <p id="fullNameDisplay">Name: Loading...</p>
            <p id="phoneNumberDisplay">Phone Number: Loading...</p>
        </div>

        <!-- Input field to update full name -->
        <label for="fullNameInput">Full Name:</label>
        <input type="text" id="fullNameInput" placeholder="Enter your full name"><br>

        <!-- Input field to update phone number -->
        <label for="phoneNumberInput">Phone Number:</label>
        <input type="text" id="phoneNumberInput" placeholder="Enter your phone number"><br>

        <!-- Button Container -->
        <div class="button-container">
            <!-- Update Button -->
            <button id="updateButton" class="update-btn">Update Profile</button>

            <!-- Logout Button -->
            <button id="logoutButton" class="logout-btn">Logout</button>
        </div>
    </div>

    <script type="module">
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBWUgDGKxItsHeNiluSEAotMu1wnV_2E1I",
            authDomain: "soulfultune-fe673.firebaseapp.com",
            databaseURL: "https://soulfultune-fe673-default-rtdb.firebaseio.com",
            projectId: "soulfultune-fe673",
            storageBucket: "soulfultune-fe673.appspot.com",
            messagingSenderId: "284247467429",
            appId: "1:284247467429:web:37aad7742411caa529f44c",
            measurementId: "G-ZFRTMLQXCY"
        };

        // Importing necessary functions from Firebase SDK
        import { getAuth, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-storage.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();
        const storage = getStorage();

        // Display Logged-In User Email and Info
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                const userUID = user.uid;
                const userDocRef = doc(db, "users", userUID);

                try {
                    const docSnap = await getDoc(userDocRef);
                    if (docSnap.exists()) {
                        const userData = docSnap.data();
                        document.getElementById("userEmail").textContent = `Email: ${user.email}`;
                        document.getElementById("fullNameDisplay").textContent = `Name: ${userData.fullName || "Not provided"}`;
                        document.getElementById("phoneNumberDisplay").textContent = `Phone Number: ${userData.phoneNumber || "Not provided"}`;
                        document.getElementById("userUIDDisplay").textContent = `UID: ${userUID}`;

                        if (userData.profileLogo) {
                            const logoUrl = await getDownloadURL(ref(storage, userData.profileLogo));
                            document.getElementById("profileLogo").src = logoUrl;
                        }
                    } else {
                        alert("No user data found.");
                    }
                } catch (error) {
                    console.error("Error fetching user data:", error);
                }
            } else {
                alert("No user is logged in. Redirecting to login page.");
                window.location.href = "login.html";
            }
        });

        // Profile Logo Upload Handler
        document.getElementById("logoContainer").addEventListener("click", async () => {
            const fileInput = document.createElement("input");
            fileInput.type = "file";
            fileInput.accept = "image/*";
            fileInput.click();

            fileInput.onchange = async () => {
                const file = fileInput.files[0];
                if (file) {
                    const user = auth.currentUser;
                    const logoPath = `logos/${user.uid}/${file.name}`;
                    const storageRef = ref(storage, logoPath);

                    try {
                        await uploadBytes(storageRef, file);
                        await updateDoc(doc(db, "users", user.uid), { profileLogo: logoPath });
                        alert("Profile logo updated successfully.");
                        location.reload();
                    } catch (error) {
                        console.error("Error uploading logo:", error);
                        alert("Failed to update profile logo.");
                    }
                }
            };
        });

        // Other existing event listeners (update profile, logout) remain unchanged
    </script>
</body>
</html>